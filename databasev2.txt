CREATE TABLE ACTIVITY_LOG (
    log_id INT NOT NULL,
    action VARCHAR(100) NOT NULL,
    timestamp DATETIME NOT NULL,
    details TEXT,
    USER_user_id INT NOT NULL,
    PRIMARY KEY (log_id)
);

CREATE TABLE ARTICLE (
    article_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    source_url VARCHAR(255) NOT NULL,
    date_published DATE,
    submission_date DATE NOT NULL,
    status ENUM('pending', 'approved', 'rejected', 'fake', 'true') NOT NULL,
    detection_result ENUM('real', 'fake') NOT NULL,
    CATEGORY_category_id INT NOT NULL,
    USER_user_id INT NOT NULL,
    PRIMARY KEY (article_id)
);

CREATE TABLE ARTICLE_KEYWORD (
    ARTICLE_article_id INT NOT NULL,
    KEYWORD_keyword_id INT NOT NULL,
    PRIMARY KEY (ARTICLE_article_id, KEYWORD_keyword_id)
);

CREATE TABLE CATEGORY (
    category_id INT NOT NULL,
    name VARCHAR(100) NOT NULL,
    description VARCHAR(255) NOT NULL,
    PRIMARY KEY (category_id),
    UNIQUE (name)
);

CREATE TABLE `COMMENT` (
    comment_id INT NOT NULL,
    content TEXT NOT NULL,
    created_at DATETIME NOT NULL,
    ARTICLE_article_id INT NOT NULL,
    USER_user_id INT NOT NULL,
    PRIMARY KEY (comment_id)
);

CREATE TABLE EXPORT_LOG (
    export_id INT NOT NULL,
    type ENUM('articles', 'user') NOT NULL,
    timestamp DATETIME NOT NULL,
    USER_user_id INT NOT NULL,
    PRIMARY KEY (export_id)
);

CREATE TABLE KEYWORD (
    keyword_id INT NOT NULL,
    word VARCHAR(100) NOT NULL,
    PRIMARY KEY (keyword_id),
    UNIQUE (word)
);

CREATE TABLE `USER` (
    user_id INT NOT NULL AUTO_INCREMENT,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    middle_name VARCHAR(100),
    age INT NOT NULL,
    email VARCHAR(80) NOT NULL,
    username VARCHAR(100) NOT NULL,
    password_hash_md5 VARCHAR(255) NOT NULL,
    confirm_password_md5 VARCHAR(255) NOT NULL,
    phone_number VARCHAR(11),
    admin_role ENUM('user', 'admin') NOT NULL,
    PRIMARY KEY (user_id),
    UNIQUE (email)
);

ALTER TABLE ACTIVITY_LOG
    ADD CONSTRAINT ACTIVITY_LOG_USER_FK FOREIGN KEY (USER_user_id) REFERENCES `USER` (user_id);

ALTER TABLE ARTICLE
    ADD CONSTRAINT ARTICLE_CATEGORY_FK FOREIGN KEY (CATEGORY_category_id) REFERENCES CATEGORY (category_id);

ALTER TABLE ARTICLE_KEYWORD
    ADD CONSTRAINT ARTICLE_KEYWORD_ARTICLE_FK FOREIGN KEY (ARTICLE_article_id) REFERENCES ARTICLE (article_id);

ALTER TABLE ARTICLE_KEYWORD
    ADD CONSTRAINT ARTICLE_KEYWORD_KEYWORD_FK FOREIGN KEY (KEYWORD_keyword_id) REFERENCES KEYWORD (keyword_id);

ALTER TABLE ARTICLE
    ADD CONSTRAINT ARTICLE_USER_FK FOREIGN KEY (USER_user_id) REFERENCES `USER` (user_id);

ALTER TABLE `COMMENT`
    ADD CONSTRAINT COMMENT_ARTICLE_FK FOREIGN KEY (ARTICLE_article_id) REFERENCES ARTICLE (article_id);

ALTER TABLE `COMMENT`
    ADD CONSTRAINT COMMENT_USER_FK FOREIGN KEY (USER_user_id) REFERENCES `USER` (user_id);

ALTER TABLE EXPORT_LOG
    ADD CONSTRAINT EXPORT_LOG_USER_FK FOREIGN KEY (USER_user_id) REFERENCES `USER` (user_id);

ALTER TABLE ACTIVITY_LOG
    MODIFY log_id INT NOT NULL AUTO_INCREMENT;

ALTER TABLE ARTICLE
    MODIFY article_id INT NOT NULL AUTO_INCREMENT;

ALTER TABLE CATEGORY
    MODIFY category_id INT NOT NULL AUTO_INCREMENT;

ALTER TABLE `COMMENT`
    MODIFY comment_id INT NOT NULL AUTO_INCREMENT;

ALTER TABLE EXPORT_LOG
    MODIFY export_id INT NOT NULL AUTO_INCREMENT;

ALTER TABLE KEYWORD
    MODIFY keyword_id INT NOT NULL AUTO_INCREMENT;

ALTER TABLE `COMMENT`
DROP FOREIGN KEY COMMENT_ARTICLE_FK;

ALTER TABLE `COMMENT`
ADD CONSTRAINT COMMENT_ARTICLE_FK
FOREIGN KEY (`ARTICLE_article_id`) REFERENCES ARTICLE (`article_id`)
ON DELETE CASCADE;

ALTER TABLE ARTICLE
DROP FOREIGN KEY ARTICLE_USER_FK;

ALTER TABLE ARTICLE
ADD CONSTRAINT ARTICLE_USER_FK
FOREIGN KEY (USER_user_id) REFERENCES `USER` (user_id)
ON DELETE CASCADE;

ALTER TABLE ARTICLE
DROP FOREIGN KEY ARTICLE_CATEGORY_FK;

ALTER TABLE ARTICLE
ADD CONSTRAINT ARTICLE_CATEGORY_FK
FOREIGN KEY (CATEGORY_category_id) REFERENCES CATEGORY (category_id)
ON DELETE CASCADE;

ALTER TABLE ACTIVITY_LOG
DROP FOREIGN KEY ACTIVITY_LOG_USER_FK;

ALTER TABLE ACTIVITY_LOG
ADD CONSTRAINT ACTIVITY_LOG_USER_FK
FOREIGN KEY (USER_user_id) REFERENCES `USER` (user_id)
ON DELETE CASCADE;

ALTER TABLE ARTICLE_KEYWORD
DROP FOREIGN KEY ARTICLE_KEYWORD_ARTICLE_FK;

ALTER TABLE ARTICLE_KEYWORD
ADD CONSTRAINT ARTICLE_KEYWORD_ARTICLE_FK
FOREIGN KEY (ARTICLE_article_id) REFERENCES ARTICLE(article_id)
ON DELETE CASCADE;
